---
title: "Cap√≠tulo 3 ‚Äî Datos externos (leer y guardar archivos con pandas)"
---

[üöÄ Abrir este cap√≠tulo en Google Colab](https://colab.research.google.com/github/FraRafa/manual/blob/main/notebooks/03-datos-externos.ipynb){.btn .btn-success target="_blank"}

```{python}
#| include: false
# Setup interno (se ejecuta, pero no se muestra en HTML/PDF)
import sys
```

::: {.callout-note}
## Objetivos del cap√≠tulo

Al terminar este cap√≠tulo vas a poder:

- leer datos desde archivos comunes (`.txt`, `.csv`, `.xlsx`) usando `pandas`,
- entender los par√°metros m√°s importantes de lectura: `sep`, `header`, `names`,
- guardar tus datos desde Python (`to_csv`, `to_excel`) de forma reproducible,
- distinguir claramente lo **local** (sin internet) de lo **online** (opcional, depende de conexi√≥n).
:::

---

## 1. La idea general: ‚Äúarchivo ‚Üí DataFrame‚Äù

En la pr√°ctica, casi todo flujo de datos es:

1) **leer** un archivo en un `DataFrame`  
2) **transformar** (limpiar, filtrar, crear variables)  
3) **guardar** el resultado

::: {.column-margin}
<details>
<summary><strong>Glosario</strong></summary>

- **DataFrame**: tabla de datos en `pandas` (filas y columnas).
- **CSV**: archivo de texto con valores separados por comas.
- **delimiter / sep**: separador entre columnas (coma, espacio, tab, etc.).
- **header**: indica si el archivo tiene fila de nombres.
- **ruta (path)**: ubicaci√≥n del archivo (ej. `Datos/mi_archivo.csv`).
- **relativa**: ruta desde tu carpeta del proyecto.
- **absoluta**: ruta completa del disco (m√°s fr√°gil).
</details>
:::

---

## 2. Leer archivos de texto (`.txt`) y CSV (`.csv`)

Vamos a usar ejemplos **locales** (sin internet). Para simular un archivo, usaremos `StringIO` (un ‚Äúarchivo en memoria‚Äù).

```{python}
import pandas as pd
from io import StringIO
```

::: {.callout-note}
### Sintaxis clave (leer archivos)

- `pd.read_table(...)` se usa para texto con separador (por ejemplo espacios o tabulaciones).
- `pd.read_csv(...)` se usa para CSV (separado por comas).
- En ambos, el separador se controla con `sep=` (o `delimiter=`).
:::

---

### 2.1 Texto con separador por espacios

```{python}
texto = '''year product1 product2 product3
2010  3        1        2
2011  4        2        2
2012  6        3        1
'''

df_txt = pd.read_table(StringIO(texto), sep=r"\s+")
df_txt
```

**Qu√© significa `sep=r"\s+"`**  
- `\s+` es ‚Äúuno o m√°s espacios‚Äù (sirve si hay varios espacios entre columnas).

---

### 2.2 CSV simple

```{python}
csv = '''year,product1,product2,product3
2010,3,1,2
2011,4,2,2
2012,6,3,1
'''

df_csv = pd.read_csv(StringIO(csv))
df_csv
```

---

### 2.3 Cuando el archivo NO tiene encabezados

A veces un archivo viene sin nombres de columnas. En ese caso:

- `header=None` para decir ‚Äúno hay encabezado‚Äù
- `names=[...]` para asignar nombres

```{python}
csv_sin_header = '''2010,3,1,2
2011,4,2,2
2012,6,3,1
'''

df_csv2 = pd.read_csv(
    StringIO(csv_sin_header),
    header=None,
    names=["year", "product1", "product2", "product3"]
)
df_csv2
```

---

## 3. Guardar datos (exportar)

Guardar es importante por 2 razones:
- para no perder trabajo,
- para poder compartir resultados.

::: {.callout-note}
### Sintaxis clave (guardar)

- `df.to_csv("archivo.csv", index=False)` guarda CSV.
- `df.to_excel("archivo.xlsx", index=False)` guarda Excel.
- `index=False` evita guardar la columna de √≠ndice como una columna extra.
:::

---

### 3.1 Guardar CSV (ejemplo)

```{python}
#| eval: false
df_csv2.to_csv("salida_ejemplo.csv", index=False)
```

> En el manual (Quarto) no lo ejecutamos para no crear archivos en el render.  
> En VSCode o Colab s√≠ puedes ejecutarlo sin problema.

---

### 3.2 Guardar Excel (ejemplo)

```{python}
#| eval: false
df_csv2.to_excel("salida_ejemplo.xlsx", index=False)
```

---

## 4. Leer Excel (`.xlsx`) sin depender de internet

Para practicar la sintaxis sin archivos externos, vamos a:

1) crear un `DataFrame`,
2) guardarlo a un Excel en memoria,
3) volverlo a leer con `read_excel`.

```{python}
from io import BytesIO
```

```{python}
df_base = pd.DataFrame({"A": [1, 2, 3], "B": [10, 20, 30]})
buffer = BytesIO()

with pd.ExcelWriter(buffer, engine="openpyxl") as writer:
    df_base.to_excel(writer, sheet_name="Hoja1", index=False)

buffer.seek(0)

df_excel = pd.read_excel(buffer, sheet_name="Hoja1")
df_excel
```

::: {.callout-tip}
**Por qu√© hacemos esto**  
Porque te permite aprender `read_excel()` sin depender de archivos externos ni internet.
:::

---

## 5. Aplicaci√≥n con datos reales (opcional, online)

Todo lo de esta secci√≥n **depende de internet** y puede fallar en renderizaci√≥n local.  
Por eso, en el manual lo dejamos **comentado** (`eval: false`).  
En **Google Colab** suele funcionar mejor.

---

### 5.1 Bases de ejemplo (wooldridge)

```{python}
#| eval: false
# En VSCode: pip install wooldridge
# En Colab:  !pip -q install wooldridge
import wooldridge as woo

wage1 = woo.dataWoo("wage1")
wage1.head()
```

---

### 5.2 Datos financieros y macro (FRED / Stooq / Yahoo Finance)

```{python}
#| eval: false
# En Colab:
# !pip -q install pandas_datareader yfinance

import pandas_datareader as pdr
import yfinance as yf

wti = pdr.data.DataReader(
    name="DCOILWTICO",
    data_source="fred",
    start="2014-01-01",
    end="2024-12-31"
)

aapl = pdr.data.DataReader(
    name="AAPL",
    data_source="stooq",
    start="2017-01-01",
    end="2024-12-31"
)

btc = yf.download(
    "BTC-USD",
    start="2017-01-01",
    end="2024-12-31",
    auto_adjust=False
)

wti.tail(), aapl.head(), btc.head()
```

---

### 5.3 Datos desde un enlace (Google Drive)

```{python}
#| eval: false
df_online = pd.read_table(
    "https://drive.google.com/uc?id=TU_ID",
    sep=r"\s+"
)
df_online.head()
```

---

## Ejercicios propuestos

1) **Lectura sin encabezado**  
   Crea un CSV sin encabezado con 4 columnas (puedes copiar el ejemplo del cap√≠tulo). L√©elo con `read_csv` y asigna los nombres `["a","b","c","d"]`.

   **Respuesta esperada:** un `DataFrame` con columnas exactamente `a, b, c, d` y 3 filas.

2) **Separadores ‚Äúraros‚Äù**  
   Crea un texto donde las columnas est√©n separadas por varios espacios (no uno). L√©elo con `read_table` usando `sep=r"\s+"`.

   **Respuesta esperada:** un `DataFrame` con las columnas correctas (sin que se junte todo en una sola columna).

3) **Exportaci√≥n consistente**  
   Toma un `DataFrame` cualquiera del cap√≠tulo y guarda:
   - un CSV sin √≠ndice,
   - un Excel sin √≠ndice.

   **Respuesta esperada:** dos archivos creados (`.csv` y `.xlsx`) sin una columna extra de √≠ndice.

4) **Excel con hojas**  
   Crea un Excel en memoria con dos hojas (`Hoja1`, `Hoja2`), cada una con un DataFrame distinto. Luego lee solo `Hoja2`.

   **Respuesta esperada:** `read_excel(..., sheet_name="Hoja2")` devuelve exactamente la tabla de `Hoja2`.

5) **Mini-proyecto**  
   Crea un `DataFrame` con columnas `ventas` y `clientes`. Calcula `ventas_por_cliente`, luego guarda el resultado en CSV.

   **Respuesta esperada:** un `DataFrame` con 3 columnas (`ventas`, `clientes`, `ventas_por_cliente`) y un CSV con esas mismas columnas.

---

::: {.content-visible when-format="pdf"}
## Glosario (para Colab)

- **DataFrame**: tabla de datos en `pandas`.
- **CSV**: archivo de texto con valores separados por comas.
- **sep / delimiter**: separador entre columnas.
- **header**: indica si el archivo trae nombres de columnas.
- **ruta**: ubicaci√≥n del archivo en tu computador.
- **relativa**: ruta desde la carpeta del proyecto.
- **absoluta**: ruta completa (m√°s fr√°gil).
:::
