{
  "hash": "73afd9fe4d03a876dac09b2039d83d83",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Cap√≠tulo 6 ‚Äî Limpieza y transformaci√≥n de datos con pandas\"\n---\n\n[üöÄ Abrir este cap√≠tulo en Google Colab](https://colab.research.google.com/github/FraRafa/manual/blob/main/notebooks/06-limpieza-y-transformacion-pandas.ipynb){.btn .btn-success target=\"_blank\"}\n\n\n::: {.callout-note}\n## Objetivos del cap√≠tulo\n\nAl terminar este cap√≠tulo vas a poder:\n\n- filtrar filas con condiciones (m√°s de una condici√≥n a la vez),\n- crear nuevas columnas de forma clara y segura,\n- tratar valores faltantes (`NaN`) con `isna`, `fillna`, `dropna`,\n- ordenar y resumir datos con `sort_values` y `groupby`,\n- combinar tablas con `merge` (joins).\n:::\n\n---\n\n## 1. Preparar un DataFrame de ejemplo (local)\n\nTrabajaremos con un ejemplo peque√±o (sin internet) para enfocarnos en la **sintaxis**.\n\n::: {#d66ac729 .cell execution_count=2}\n``` {.python .cell-code}\nimport numpy as np\nimport pandas as pd\n\ndf = pd.DataFrame({\n    \"id\": [1, 2, 3, 4, 5, 6],\n    \"ciudad\": [\"Quito\", \"Quito\", \"Cuenca\", \"Cuenca\", \"Quito\", \"Cuenca\"],\n    \"ventas\": [100, 120, np.nan, 90, 130, 110],\n    \"clientes\": [20, 25, 18, np.nan, 30, 22]\n})\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>ciudad</th>\n      <th>ventas</th>\n      <th>clientes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>Quito</td>\n      <td>100.0</td>\n      <td>20.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>Quito</td>\n      <td>120.0</td>\n      <td>25.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>3</td>\n      <td>Cuenca</td>\n      <td>NaN</td>\n      <td>18.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>4</td>\n      <td>Cuenca</td>\n      <td>90.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>5</td>\n      <td>Quito</td>\n      <td>130.0</td>\n      <td>30.0</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>6</td>\n      <td>Cuenca</td>\n      <td>110.0</td>\n      <td>22.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.callout-note}\n### Sintaxis clave (DataFrame)\n\n- `pd.DataFrame({columna: lista, ...})` crea una tabla.\n- `np.nan` representa un valor faltante.\n:::\n\n::: {.column-margin}\n<details>\n<summary><strong>Glosario</strong></summary>\n\n- **NaN**: ‚ÄúNot a Number‚Äù; en `pandas` significa ‚Äúfaltante‚Äù.\n- **filtro**: seleccionar filas que cumplen una condici√≥n.\n- **booleano**: `True`/`False`.\n- **operadores l√≥gicos**: `&` (y), `|` (o), `~` (no).\n- **join / merge**: unir tablas por una llave (clave).\n- **llave (key)**: columna usada para unir (por ejemplo `id`).\n</details>\n:::\n\n---\n\n## 2. Filtrar filas (condiciones)\n\n### 2.1 Una condici√≥n simple\n\n::: {#15eb2f99 .cell execution_count=3}\n``` {.python .cell-code}\ndf[df[\"ciudad\"] == \"Quito\"]\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>ciudad</th>\n      <th>ventas</th>\n      <th>clientes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>Quito</td>\n      <td>100.0</td>\n      <td>20.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>Quito</td>\n      <td>120.0</td>\n      <td>25.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>5</td>\n      <td>Quito</td>\n      <td>130.0</td>\n      <td>30.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.callout-note}\n### Sintaxis clave (filtros)\n\n- La condici√≥n va **entre corchetes**: `df[condicion]`\n- La condici√≥n produce una serie de `True/False`\n:::\n\n---\n\n### 2.2 Dos condiciones a la vez\n\nPara combinar condiciones usa **par√©ntesis** y `&` o `|`.\n\n::: {#b19c6415 .cell execution_count=4}\n``` {.python .cell-code}\ndf[(df[\"ciudad\"] == \"Quito\") & (df[\"ventas\"] >= 120)]\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>ciudad</th>\n      <th>ventas</th>\n      <th>clientes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>Quito</td>\n      <td>120.0</td>\n      <td>25.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>5</td>\n      <td>Quito</td>\n      <td>130.0</td>\n      <td>30.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.callout-note}\n### Sintaxis clave (AND / OR)\n\n- AND: `(cond1) & (cond2)`\n- OR: `(cond1) | (cond2)`\n- NOT: `~(condicion)`\n- Siempre usa par√©ntesis en cada condici√≥n para evitar errores.\n:::\n\n---\n\n## 3. Crear nuevas columnas (transformaci√≥n)\n\n### 3.1 Una columna calculada\n\n::: {#478d2d43 .cell execution_count=5}\n``` {.python .cell-code}\ndf[\"ventas_por_cliente\"] = df[\"ventas\"] / df[\"clientes\"]\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>ciudad</th>\n      <th>ventas</th>\n      <th>clientes</th>\n      <th>ventas_por_cliente</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>Quito</td>\n      <td>100.0</td>\n      <td>20.0</td>\n      <td>5.000000</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>Quito</td>\n      <td>120.0</td>\n      <td>25.0</td>\n      <td>4.800000</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>3</td>\n      <td>Cuenca</td>\n      <td>NaN</td>\n      <td>18.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>4</td>\n      <td>Cuenca</td>\n      <td>90.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>5</td>\n      <td>Quito</td>\n      <td>130.0</td>\n      <td>30.0</td>\n      <td>4.333333</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>6</td>\n      <td>Cuenca</td>\n      <td>110.0</td>\n      <td>22.0</td>\n      <td>5.000000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.callout-warning}\n**Ojo**  \nSi hay `NaN`, el resultado tambi√©n puede quedar en `NaN`. Eso es normal.\n:::\n\n---\n\n### 3.2 Transformaci√≥n con `where` (condici√≥n dentro de la columna)\n\nEjemplo: si `clientes` es 0 o faltante, no calculamos la raz√≥n.\n\n::: {#54df678e .cell execution_count=6}\n``` {.python .cell-code}\ndf[\"ventas_por_cliente_segura\"] = np.where(\n    df[\"clientes\"].isna() | (df[\"clientes\"] == 0),\n    np.nan,\n    df[\"ventas\"] / df[\"clientes\"]\n)\ndf[[\"ventas\", \"clientes\", \"ventas_por_cliente_segura\"]]\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>ventas</th>\n      <th>clientes</th>\n      <th>ventas_por_cliente_segura</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>100.0</td>\n      <td>20.0</td>\n      <td>5.000000</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>120.0</td>\n      <td>25.0</td>\n      <td>4.800000</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>NaN</td>\n      <td>18.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>90.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>130.0</td>\n      <td>30.0</td>\n      <td>4.333333</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>110.0</td>\n      <td>22.0</td>\n      <td>5.000000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.callout-note}\n### Sintaxis clave (`np.where`)\n\n- `np.where(cond, valor_si_true, valor_si_false)`\n- √ötil para crear columnas con reglas claras.\n:::\n\n---\n\n## 4. Valores faltantes (`NaN`)\n\n### 4.1 Detectar faltantes\n\n::: {#5804389a .cell execution_count=7}\n``` {.python .cell-code}\ndf.isna()\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>ciudad</th>\n      <th>ventas</th>\n      <th>clientes</th>\n      <th>ventas_por_cliente</th>\n      <th>ventas_por_cliente_segura</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>False</td>\n      <td>False</td>\n      <td>True</td>\n      <td>False</td>\n      <td>True</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n      <td>True</td>\n      <td>True</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n      <td>False</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#d432352b .cell execution_count=8}\n``` {.python .cell-code}\ndf[\"ventas\"].isna()\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```\n0    False\n1    False\n2     True\n3    False\n4    False\n5    False\nName: ventas, dtype: bool\n```\n:::\n:::\n\n\n---\n\n### 4.2 Contar faltantes por columna\n\n::: {#260001c2 .cell execution_count=9}\n``` {.python .cell-code}\ndf.isna().sum()\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```\nid                           0\nciudad                       0\nventas                       1\nclientes                     1\nventas_por_cliente           2\nventas_por_cliente_segura    2\ndtype: int64\n```\n:::\n:::\n\n\n---\n\n### 4.3 Eliminar filas con faltantes\n\n::: {#1c52ebba .cell execution_count=10}\n``` {.python .cell-code}\ndf_sin_na = df.dropna()\ndf_sin_na\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>ciudad</th>\n      <th>ventas</th>\n      <th>clientes</th>\n      <th>ventas_por_cliente</th>\n      <th>ventas_por_cliente_segura</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>Quito</td>\n      <td>100.0</td>\n      <td>20.0</td>\n      <td>5.000000</td>\n      <td>5.000000</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>Quito</td>\n      <td>120.0</td>\n      <td>25.0</td>\n      <td>4.800000</td>\n      <td>4.800000</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>5</td>\n      <td>Quito</td>\n      <td>130.0</td>\n      <td>30.0</td>\n      <td>4.333333</td>\n      <td>4.333333</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>6</td>\n      <td>Cuenca</td>\n      <td>110.0</td>\n      <td>22.0</td>\n      <td>5.000000</td>\n      <td>5.000000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.callout-note}\n### Sintaxis clave (`dropna`)\n\n- `df.dropna()` elimina filas que tengan **alg√∫n** `NaN`.\n- Es simple, pero puede botar demasiados datos si hay muchos faltantes.\n:::\n\n---\n\n### 4.4 Rellenar faltantes (imputaci√≥n simple)\n\nEjemplo: rellenar faltantes de `ventas` con el promedio.\n\n::: {#afcd8aa5 .cell execution_count=11}\n``` {.python .cell-code}\nprom_ventas = df[\"ventas\"].mean()\ndf[\"ventas_fill\"] = df[\"ventas\"].fillna(prom_ventas)\ndf[[\"ventas\", \"ventas_fill\"]]\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>ventas</th>\n      <th>ventas_fill</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>100.0</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>120.0</td>\n      <td>120.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>NaN</td>\n      <td>110.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>90.0</td>\n      <td>90.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>130.0</td>\n      <td>130.0</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>110.0</td>\n      <td>110.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.callout-note}\n### Sintaxis clave (`fillna`)\n\n- `serie.fillna(valor)` reemplaza `NaN` por `valor`.\n- Es com√∫n usar promedios o medianas, seg√∫n el caso.\n:::\n\n---\n\n## 5. Ordenar y resumir\n\n### 5.1 Ordenar\n\n::: {#189122f3 .cell execution_count=12}\n``` {.python .cell-code}\ndf.sort_values(\"ventas\", ascending=False)\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>ciudad</th>\n      <th>ventas</th>\n      <th>clientes</th>\n      <th>ventas_por_cliente</th>\n      <th>ventas_por_cliente_segura</th>\n      <th>ventas_fill</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>4</th>\n      <td>5</td>\n      <td>Quito</td>\n      <td>130.0</td>\n      <td>30.0</td>\n      <td>4.333333</td>\n      <td>4.333333</td>\n      <td>130.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>Quito</td>\n      <td>120.0</td>\n      <td>25.0</td>\n      <td>4.800000</td>\n      <td>4.800000</td>\n      <td>120.0</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>6</td>\n      <td>Cuenca</td>\n      <td>110.0</td>\n      <td>22.0</td>\n      <td>5.000000</td>\n      <td>5.000000</td>\n      <td>110.0</td>\n    </tr>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>Quito</td>\n      <td>100.0</td>\n      <td>20.0</td>\n      <td>5.000000</td>\n      <td>5.000000</td>\n      <td>100.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>4</td>\n      <td>Cuenca</td>\n      <td>90.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>90.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>3</td>\n      <td>Cuenca</td>\n      <td>NaN</td>\n      <td>18.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>110.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n---\n\n### 5.2 Resumir por grupos (`groupby`)\n\nPromedio de ventas por ciudad:\n\n::: {#14d736e3 .cell execution_count=13}\n``` {.python .cell-code}\ndf.groupby(\"ciudad\")[\"ventas\"].mean()\n```\n\n::: {.cell-output .cell-output-display execution_count=13}\n```\nciudad\nCuenca    100.000000\nQuito     116.666667\nName: ventas, dtype: float64\n```\n:::\n:::\n\n\nM√°s de una estad√≠stica:\n\n::: {#cab887cb .cell execution_count=14}\n``` {.python .cell-code}\ndf.groupby(\"ciudad\")[[\"ventas\", \"clientes\"]].agg([\"mean\", \"count\"])\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead tr th {\n        text-align: left;\n    }\n\n    .dataframe thead tr:last-of-type th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr>\n      <th></th>\n      <th colspan=\"2\" halign=\"left\">ventas</th>\n      <th colspan=\"2\" halign=\"left\">clientes</th>\n    </tr>\n    <tr>\n      <th></th>\n      <th>mean</th>\n      <th>count</th>\n      <th>mean</th>\n      <th>count</th>\n    </tr>\n    <tr>\n      <th>ciudad</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Cuenca</th>\n      <td>100.000000</td>\n      <td>2</td>\n      <td>20.0</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>Quito</th>\n      <td>116.666667</td>\n      <td>3</td>\n      <td>25.0</td>\n      <td>3</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.callout-note}\n### Sintaxis clave (`groupby`)\n\n- `df.groupby(\"col\")[\"y\"].mean()` ‚Üí promedio de `y` por grupo.\n- `agg([...])` permite varias estad√≠sticas.\n:::\n\n---\n\n## 6. Unir tablas con `merge`\n\nImagina que tienes otra tabla con informaci√≥n de cada ciudad:\n\n::: {#5ea36ec2 .cell execution_count=15}\n``` {.python .cell-code}\nciudades = pd.DataFrame({\n    \"ciudad\": [\"Quito\", \"Cuenca\"],\n    \"region\": [\"Sierra\", \"Sierra\"],\n    \"altitud_m\": [2850, 2550]\n})\nciudades\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>ciudad</th>\n      <th>region</th>\n      <th>altitud_m</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>Quito</td>\n      <td>Sierra</td>\n      <td>2850</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>Cuenca</td>\n      <td>Sierra</td>\n      <td>2550</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nUnimos por la columna `ciudad`:\n\n::: {#b9b1dff1 .cell execution_count=16}\n``` {.python .cell-code}\ndf_merged = df.merge(ciudades, on=\"ciudad\", how=\"left\")\ndf_merged\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>ciudad</th>\n      <th>ventas</th>\n      <th>clientes</th>\n      <th>ventas_por_cliente</th>\n      <th>ventas_por_cliente_segura</th>\n      <th>ventas_fill</th>\n      <th>region</th>\n      <th>altitud_m</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>Quito</td>\n      <td>100.0</td>\n      <td>20.0</td>\n      <td>5.000000</td>\n      <td>5.000000</td>\n      <td>100.0</td>\n      <td>Sierra</td>\n      <td>2850</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>Quito</td>\n      <td>120.0</td>\n      <td>25.0</td>\n      <td>4.800000</td>\n      <td>4.800000</td>\n      <td>120.0</td>\n      <td>Sierra</td>\n      <td>2850</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>3</td>\n      <td>Cuenca</td>\n      <td>NaN</td>\n      <td>18.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>110.0</td>\n      <td>Sierra</td>\n      <td>2550</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>4</td>\n      <td>Cuenca</td>\n      <td>90.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>90.0</td>\n      <td>Sierra</td>\n      <td>2550</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>5</td>\n      <td>Quito</td>\n      <td>130.0</td>\n      <td>30.0</td>\n      <td>4.333333</td>\n      <td>4.333333</td>\n      <td>130.0</td>\n      <td>Sierra</td>\n      <td>2850</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>6</td>\n      <td>Cuenca</td>\n      <td>110.0</td>\n      <td>22.0</td>\n      <td>5.000000</td>\n      <td>5.000000</td>\n      <td>110.0</td>\n      <td>Sierra</td>\n      <td>2550</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.callout-note}\n### Sintaxis clave (`merge`)\n\n- `df.merge(otra, on=\"llave\", how=\"left\")`\n- `how=\"left\"` conserva todas las filas del `df` original.\n- `how=\"inner\"` conserva solo coincidencias en ambas tablas.\n:::\n\n---\n\n## 7. Aplicaci√≥n con datos reales (opcional, online)\n\nEn el manual no lo ejecutamos (`eval: false`). En Colab suele funcionar mejor.\n\n::: {#3c228dc7 .cell execution_count=17}\n``` {.python .cell-code}\n# !pip -q install wooldridge\nimport wooldridge as woo\n\nwage1 = woo.dataWoo(\"wage1\")\n\n# Ejemplo: crear una variable transformada y resumir\nwage1[\"lwage\"] = np.log(wage1[\"wage\"])\nwage1.groupby(\"female\")[[\"wage\", \"lwage\"]].mean()\n```\n:::\n\n\n---\n\n## Ejercicios propuestos\n\n1) **Filtro con dos condiciones**  \n   Con el `df` del cap√≠tulo, selecciona filas donde `ciudad` sea `\"Cuenca\"` y `ventas` sea mayor o igual a 100.\n\n   **Respuesta esperada:** solo la fila de Cuenca con `ventas=110` (y cualquier otra que cumpla si cambiaste datos).\n\n2) **Columna con regla**  \n   Crea una columna `ventas_altas` que sea `True` si `ventas >= 120` y `False` en caso contrario.\n\n   **Respuesta esperada:** `True` en las filas con ventas 120 y 130; `False` en 100, 90, 110; y `False` o `NaN` para el faltante dependiendo de tu implementaci√≥n (pero debe ser consistente).\n\n3) **Imputaci√≥n**  \n   Rellena los `NaN` de `ventas` con la mediana de `ventas`.\n\n   **Respuesta esperada:** la columna de `ventas` ya no tiene `NaN` (la fila faltante toma la mediana).\n\n4) **Groupby con dos columnas**  \n   Calcula el promedio de `ventas` y `clientes` por `ciudad`.\n\n   **Respuesta esperada:** dos promedios por ciudad (Quito y Cuenca) para ambas variables.\n\n5) **Merge (left join)**  \n   Crea un `DataFrame` de ciudades con una columna extra (por ejemplo `pais=\"Ecuador\"`) y haz un `left merge` sobre `ciudad`.\n\n   **Respuesta esperada:** `df_merged` conserva el mismo n√∫mero de filas que `df` y agrega las nuevas columnas.\n\n6) **Mini-proyecto**  \n   Crea un `DataFrame` con 10 filas (inventado) con columnas `grupo` y `valor`.  \n   - Inserta 2 valores faltantes en `valor`.  \n   - Imputa los faltantes con el promedio del grupo.  \n   - Luego calcula el promedio final por grupo.\n\n   **Respuesta esperada:** no quedan `NaN` y obtienes un promedio final por cada grupo.\n\n---\n\n::: {.content-visible when-format=\"pdf\"}\n## Glosario (para Colab)\n\n- **NaN**: valor faltante.\n- **filtro**: selecci√≥n de filas que cumplen una condici√≥n.\n- **booleano**: `True/False`.\n- **& / | / ~**: operadores l√≥gicos (y / o / no).\n- **merge**: unir tablas por una llave.\n- **llave**: columna usada para unir.\n:::\n\n",
    "supporting": [
      "06-limpieza-y-transformacion-pandas_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}